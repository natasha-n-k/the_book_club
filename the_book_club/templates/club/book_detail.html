{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="book-container">
    <div class="book-cart-container">
        <div class="book-cart-row">
            <div class="book-cart-item">
                <div class="book-cart-image">
                    <img src="{{ book.image.url }}" width="170" height="250">
                </div>
                <div class="book-cart-details">
                    <div class="book-rating">
                        {% if book.average_rating %}
                        <h3>★ {{ book.average_rating }}</h3>
                        {% else %}
                        <h3>★ Нет оценок</h3>
                        {% endif %}
                    </div>
                    <h5>{{ book.genre }}</h5>
                    <h3>{{ book.name }}</h3>
                    <h4>{{ book.author }}</h4>
                    <p>{{ book.description }}</p>
                </div>
            </div>
            <div class="book-status">
                <div class="status-form">
                    <form method="POST">
                        {% csrf_token %}
                        <div>
                            <button type="submit" name="status" value="to_read" {% if user_book.status == 'to_read' %}class="active"{% endif %}>Хочу прочитать</button>
                            <button type="submit" name="status" value="read" {% if user_book.status == 'read' %}class="active"{% endif %}>Прочитано</button>
                        </div>
                    </form>
                    <div class="book-status-details">
                        {% if user_book.status == 'read' %}
                            {% if user_book.date_read %}
                                <p>Книга прочитана<b> {{ user_book.date_read|date:"d.m.Y" }}</b></p>
                                {% if user.is_authenticated %}
                                    <a href="{% url 'club:comments' book.id %}">Оставьте рецензию, если прочитали книгу</a>
                                {% endif %}
                            {% endif %}
                        {% else %}
                            {# For books marked as "Want to Read" or "Not Selected" #}
                        {% endif %}
                    </div>
                </div>
                <div class="book-queue-details">
                    {% if user.is_authenticated %}
                    <form method="POST" action="{% url 'club:append_to_queue' book.id %}">
                        {% csrf_token %}
                        <select name="club">
                            {% for club in user.clubs.all %}
                            <option value="{{ club.id }}">{{ club.name }}</option>
                            {% endfor %}
                        </select>
                        <button id="add-to-queue-button" type="submit">Предложить книгу клубу</button>
                    </form>
                    {% endif %}
                </div>
            </div>
            <div>
                <div class="book-comments">
                    <h4>Рецензии на книгу:</h4>
                    {% for comment in comments %}
                    <div class="comment">
                        <p><b>{{ comment.user.username }}</b> ({{ comment.created_at|date:"d.m.Y H:i" }})</p>
                        <p>{{ comment.text }}</p>
                    </div>
                    {% empty %}
                    <p>Пока здесь пусто</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
<script src="{% static 'js/book_details.js' %}"></script>
{% endblock %}